/*
 * This file was generated by the Gradle 'init' task.
 */

version = "1.0.0"
group "com.affiancesolutions.kingtiger.server"
description "King Tiger Black Belt Tracker MicroProfile JWT"

apply plugin: "java"
apply plugin: "war"
apply plugin: "liberty"


repositories {
    mavenCentral()
    mavenLocal()
}

configurations {
    jdbcDriver
}

dependencies {
    // Third-Party APIs (WEB-INF/lib)
    implementation "com.google.firebase:firebase-admin:9.0.0"
    //implementation "com.google.firebase:firebase-auth:[21.0.0,)"
    implementation "org.slf4j:slf4j-jdk14:1.7.36"

    // Provided APIs
    providedCompile "org.eclipse.microprofile:microprofile:5.0"
    providedCompile "jakarta.platform:jakarta.jakartaee-api:9.0.0"
    providedCompile 'javax.servlet:javax.servlet-api:3.0.1'
    // Liberty APIs (22.0.0.1+)
    providedCompile 'com.ibm.websphere.appserver.api:com.ibm.websphere.appserver.api.basics:[1.4.60,)'
    providedCompile 'com.ibm.websphere.appserver.api:com.ibm.websphere.appserver.api.security:[1.3.60,)'
    providedCompile 'com.ibm.websphere.appserver.api:com.ibm.websphere.appserver.api.oauth:[1.2.60,)'



    // JDBC Driver
    jdbcDriver "mysql:mysql-connector-java:[8.0.29,)"

    // Liberty Gradle Plugin Runtime
    libertyRuntime "io.openliberty:openliberty-runtime:[22.0.0.1,)"
}

allprojects {
    tasks.withType(Copy) {
        duplicatesStrategy DuplicatesStrategy.INCLUDE
    }
}

test {
    apply from: getRootProject().file("gradle/jacoco.gradle")

    useJUnitPlatform()
}

tasks.register('copyJDBCDriver', Copy) {
    from configurations.jdbcDriver
    into layout.buildDirectory.dir("libs/jdbc")
}
libertyCreate.finalizedBy copyJDBCDriver

liberty {
    server {
        mergeServerEnv = true
        env = [
                'JDBC_DRIVER_PATH' : layout.buildDirectory.dir("libs/jdbc").get().asFile
        ]
    }
}
